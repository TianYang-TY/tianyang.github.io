<html>
<head>
    <meta charset="utf-8"/>
<meta name="description" content=""/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>éƒ¨åˆ†å®¹ç§¯æ ¡æ­£æ–¹æ³•ä¸æ“ä½œ | Yang&#39;s blog</title>

<link rel="shortcut icon" href="https://yangt.me/favicon.ico?v=1620370343144">

<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://yangt.me/styles/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css">

<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dockerfile.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dart.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script>
<!-- DEMO JS -->
<!--<script src="media/scripts/index.js"></script>-->



    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.css">
</head>
<body>
<div class="main gt-bg-theme-color-first">
    <nav class="navbar navbar-expand-lg">
    <div class="navbar-brand">
        <img class="user-avatar" src="/images/avatar.png" alt="å¤´åƒ">
        <div class="site-name gt-c-content-color-first">
            Yang&#39;s blog
        </div>
    </div>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <i class="fas fa-bars gt-c-content-color-first" style="font-size: 18px"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center">
            
                <div class="nav-item">
                    
                        <a href="/" class="menu gt-a-link">
                            é¦–é¡µ
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/archives" class="menu gt-a-link">
                            å½’æ¡£
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/tags" class="menu gt-a-link">
                            æ ‡ç­¾
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/post/about" class="menu gt-a-link">
                            å…³äº
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="friends" class="menu gt-a-link">
                            å‹é“¾
                        </a>
                    
                </div>
            
        </div>
        <div style="text-align: center">
            <form id="gridea-search-form" style="position: relative" data-update="1620370343144" action="/search/index.html">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="æœç´¢æ–‡ç« " />
                <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
        </div>
    </div>
</nav>

    <div class="post-container">
        <div class="post-detail gt-bg-theme-color-second">
            <article class="gt-post-content">
                <h2 class="post-title">
                    éƒ¨åˆ†å®¹ç§¯æ ¡æ­£æ–¹æ³•ä¸æ“ä½œ
                </h2>
                <div class="post-info">
                    <time class="post-time gt-c-content-color-first">
                        Â· 2021-04-19 Â·
                    </time>
                    
                        <a href="https://yangt.me/tag/qHlhQKMIa/" class="post-tags">
                            # PVC
                        </a>
                    
                        <a href="https://yangt.me/tag/nXH6UnePtt/" class="post-tags">
                            # Freesurfer
                        </a>
                    
                </div>
                <div class="post-content">
                    <p>éƒ¨åˆ†å®¹ç§¯æ ¡æ­£ï¼ˆPartial Volume Correctionï¼‰çš„ç›®çš„æ˜¯æ ¡æ­£ç”±äºç›®æ ‡ç‰©ä½“ç›¸å¯¹äºåˆ†è¾¨ç‡å¤§å°çš„æœ‰é™æ‰€é€ æˆçš„ä¿¡å·çš„æŸå¤±ï¼Œä»¥åŠç›®æ ‡åŒºåŸŸå¤–çš„ä¿¡å·æ±¡æŸ“ï¼Œå³æ ¡æ­£éƒ¨åˆ†å®¹ç§¯æ•ˆåº”ï¼ˆPartial Volume Effectï¼‰ã€‚å¯¹äº PVE ä¸ PVC çš„æ¦‚å¿µçŸ¥è¯†å¯ä»¥å‚è€ƒä»¥ä¸‹ä¸¤ç¯‡çŸ¥ä¹æ–‡ç« ï¼š<a href="https://zhuanlan.zhihu.com/p/46252046">Partial Volume Effectï¼ˆéƒ¨åˆ†å®¹ç§¯æ•ˆåº”ï¼‰ - çŸ¥ä¹ (zhihu.com)</a>, <a href="https://zhuanlan.zhihu.com/p/50446108">Partial Volume Correctionï¼ˆéƒ¨åˆ†å®¹ç§¯æ ¡æ­£ï¼‰ - çŸ¥ä¹ (zhihu.com)</a>ã€‚</p>
<!-- more -->
<p>ä¸‹é¢è®°å½•äº†æˆ‘ä½¿ç”¨ <a href="https://surfer.nmr.mgh.harvard.edu/">FreeSurfer</a> ä¸ <a href="https://github.com/UCL/PETPVC">PETPVC</a> çš„ PVC åŠŸèƒ½è¿›è¡Œéƒ¨åˆ†å®¹ç§¯æ ¡æ­£çš„å†…å®¹ã€‚</p>
<h2 id="freesurfer">FreeSurfer</h2>
<p>FreeSurfer çš„å®‰è£…ä¸ä½¿ç”¨å†…å®¹åœ¨å¦å¤–ä¸¤ç¯‡æ–‡æ¡£ä¸­å·²ç»è®°å½•ï¼ŒPVC çš„å†…å®¹ä¸»è¦åŒ…å«åœ¨ PETSurfer çš„å†…å®¹ä¸­ï¼Œä¹‹å‰æ ¹æ®å®˜æ–¹æ–‡æ¡£çš„æ“ä½œæ¯”è¾ƒç®€å•ï¼Œä¸‹é¢æ˜¯ä¸€äº›æ›´ä¸ºå¤æ‚çš„æ“ä½œï¼Œæ“ä½œæ—¶éœ€è¦ç¡®ä¿ Subject å·²ç»ç»è¿‡äº† <code>recon-all</code> çš„æ“ä½œã€‚</p>
<p>FreeSurfer çš„ PVC ä½¿ç”¨çš„æ˜¯ GTM å’Œ MG æ–¹æ³•ï¼Œéƒ½æ˜¯åŸºäº VOI çš„æ–¹æ³•ï¼Œæ‰€ä»¥éœ€è¦ç¡®å®šä¸€ä¸ªæ ‡ç­¾å›¾ã€‚åœ¨ FreeSurfer ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>gtmseg</code> æ¥åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„æ ‡ç­¾å›¾ï¼Œæˆ–è€…ä½¿ç”¨é»˜è®¤çš„åˆ†å‰²æ–¹å¼è·å¾—ä¸€ä¸ªåˆ†å‰²ç»“æœï¼Œä¸‹é¢å°±æ˜¯ç»ˆç«¯è¿è¡Œ <code>gtmseg --help</code> å¾—åˆ°çš„ä¸€ä¸ªç»“æœã€‚å¾—åˆ°ä¸€ä¸ªç›®æ ‡æ ‡ç­¾å›¾ä¹‹åå°±å¯ä»¥ç»§ç»­ä½¿ç”¨ <code>mri_coreg</code> å’Œ <code>mri_gtmpvc</code> çš„å‘½ä»¤å»è¿›è¡Œ PVC çš„æ“ä½œï¼Œæ“ä½œå‚æ•°ä¸ç»“æœéƒ½åœ¨ä¹‹å‰çš„æ–‡æ¡£ä¸­æœ‰å†™ã€‚</p>
<pre><code class="language-bash"># gtmseg --help
You can use your own segmentation or a modified FS segmentation. It will be easiest if you modify apas+head.mgz to insert your segmentations. apas+head.mgz is created by gtmseg but you can create it with 

xcerebralseg --s $subject --o $SUBJECTS_DIR/$subject/mri/apas+head.mgz

To create a new segmentation by replacing voxels in apas+head.mgz with your segmentation: make sure that the index you give your new segmentation(s) is not already present in apas+head.mgz. Next create a color table text file that looks something like this:

# TissueTypeSchema 
#ctTType   0  unknown                           0   0   0    0
#ctTType   1  cortex                          205  62  78    0
#ctTType   2  subcort_gm                      230 148  34    0
#ctTType   3  wm                                0 255   0    0
#ctTType   4  csf                             120  18 134    0
#ctTType   5  head                            150 150 200    0
265 MySeg            219 100 176 0 2

In the above case, it is assumed that the index that you used was 265 and that your segmentation is for subcortical gray matter (thus making the last number=2 in the MySeg row). If you have more than one segmentation you are adding, then add rows into the color table. The first 5 entries codes for the different possible tissue types.

You can then run

gtmseg --s subject --head apas+head+myseg.mgz \
   --ctab myseg.colortable.txt --o gtmseg+myseg.mgz  

where apas+head+myseg.mgz is apas+head.mgz with your new segmentation, myseg.colortable.txt is the color table you created, and gtmseg+myseg.mgz will be your output volume. Note that an output color table gtmseg+myseg.ctab will be generated. You should check in this to make sure that your segmentation appears. You can also run

tkmeditfv subject orig.mgz -seg gtmseg+myseg.mgz  myseg.colortable.txt
</code></pre>
<h2 id="petpvc">PETPVC</h2>
<p>PETPVC æ˜¯ä¸€ä¸ªå¼€æºçš„å·¥å…·ç®±ï¼Œé›†æˆäº†ä¼—å¤šçš„ PVC æ–¹æ³•ï¼Œå½“å‰æœ€æ–°ç‰ˆæœ¬ä¸º 1.2.4, ä»¥ä¸‹ä¸ºå®‰è£…ä¸ä½¿ç”¨æ–¹æ³•ã€‚</p>
<pre><code class="language-bash"># ä¸‹è½½
wget https://github.com/UCL/PETPVC/releases/download/v1.2.4/PETPVC-1.2.4-Linux.tar.gz
# è§£å‹
tar -xzvf PETPVC-1.2.4-Linux.tar.gz
# è®¾ç½®ç¯å¢ƒå˜é‡
# æ–‡ä»¶å¤¹å…¶å®ä¸å¿…è¦æ”¾åœ¨ /usr/local/ ä¸‹ï¼Œä½†æ˜¯éœ€è¦ä¿è¯ .bashrc æ–‡ä»¶ä¸­æŒ‡å‘æ­£ç¡®çš„è·¯å¾„
sudo cp -r PETPVC-1.2.4 /usr/local/PETPVC
gedit ~/.bashrc # æ‹‰åˆ°æœ€åä¸€è¡Œ
PATH=$PATH:/usr/local/PETPVC/bin
source ~/.bashrc
</code></pre>
<p>æ‰€æœ‰åŸºäº VOI çš„ PVC æ–¹æ³•åœ¨ä½¿ç”¨æ—¶å‡éœ€è¦ä¸€ä¸ªæ ‡ç­¾å›¾ï¼Œå‡è®¾ä½¿ç”¨ FreeSurfer è·å¾—çš„ <code>gtmseg.mgz</code> æ–‡ä»¶ä½œä¸ºæ ‡ç­¾å›¾ï¼Œä¸‹é¢ä¸ºå¤„ç†æµç¨‹ã€‚</p>
<ol>
<li>é¢„å¤„ç†</li>
</ol>
<p>å¦‚æœä½¿ç”¨åŸºäº VOI çš„æ–¹æ³•ï¼Œéœ€è¦ç¡®ä¿ PET å›¾åƒä¸æ ‡ç­¾å›¾å…·æœ‰åŒä¸€ç‰©ç†ç©ºé—´å’Œå›¾åƒå°ºå¯¸ï¼Œå¦åˆ™æ— æ³•è¿›è¡Œ PVCï¼Œç„¶åå¯¹æ ‡ç­¾å›¾è¿›è¡Œå¤„ç†ã€‚å¦‚æœä½¿ç”¨çº¯åŸºäºä½“ç´ çš„æ–¹æ³•ï¼Œä¸éœ€è¦ä¸‹é¢çš„é¢„å¤„ç†ã€‚</p>
<pre><code class="language-bash"># è½¬ä¸º nii/nii.gz - PETPVC ä½¿ç”¨çš„ ITK, è½¬æ¢ä¸º ITK èƒ½å¤Ÿè¯†åˆ«çš„æ ¼å¼å³å¯
mri_convert gtmseg.mgz gtmseg.nii.gz
# è½¬æ¢ä¸º 4D Maskï¼Œ4D æ–‡ä»¶ä¸­æ¯ä¸ªå›¾åƒä»£è¡¨ä¸€ä¸ªè„‘åŒº
pvc_make4d -i gtmseg.nii.gz -o 4D_gtmseg.nii.gz
</code></pre>
<ol start="2">
<li>PVC</li>
</ol>
<pre><code class="language-bash"># å®˜æ–¹ç¤ºä¾‹
petpvc -i &lt;PET&gt; -m &lt;MASK&gt; -o &lt;OUTPUT&gt; --pvc IY -x 6.0 -y 6.0 -z 6.0 [--debug]
</code></pre>
<p>å…¶ä¸­ <code>xyz</code> ä¸º PET å›¾åƒé‡‡é›†æ—¶æœºå™¨å†³å®šçš„å‚æ•° FWHMï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯å®Œå…¨åŸºäºä½“ç´ çš„ç®—æ³•ï¼Œæ¯”å¦‚ RLï¼Œé‚£ä¹ˆä¸éœ€è¦è¾“å…¥ <code>m</code> å‚æ•°ã€‚</p>
<p>å¦‚æœè§‚å¯Ÿä¹‹å‰è§£å‹å‡ºæ¥çš„ PETPVC å®‰è£…æ–‡ä»¶å¤¹ï¼Œå¯ä»¥å‘ç° <code>/bin</code> ç›®å½•ä¸‹è¿˜å­˜åœ¨ä¸å°‘ä»¥ PVC æ–¹æ³•å‘½åçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ¯”å¦‚ <code>pvc_gtm pvc_iy pvc_mg pvc_mtc pvc_rbv pvc_relabel pvc_rl pvc_vc</code> ç­‰ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è°ƒç”¨ç‰¹å®šçš„æ–¹æ³•æ¥æ‰§è¡Œï¼Œè€Œä¸”å¦‚æœç›´æ¥æ‰§è¡Œè¿™äº›æ–‡ä»¶çš„è¯ï¼Œå¯ä»¥çœ‹åˆ°ä¸“å±çš„å¸®åŠ©æ–‡æ¡£ï¼Œæ¯”å¦‚ pvc_rl çš„æ–‡æ¡£ï¼Œå¯ä»¥çœ‹åˆ°ä½¿ç”¨ petpvc çœ‹ä¸åˆ°çš„è¿­ä»£æ¬¡æ•°ç­‰å‚æ•°ã€‚</p>
<pre><code class="language-bash"># pvc_rl
Option petfile is required but not defined
Option outputfile is required but not defined
Option FWHMx is required but not defined
Option FWHMy is required but not defined
Option FWHMz is required but not defined
 Command tags: 
   -x &lt; X &gt; 
      = The full-width at half maximum in mm along x-axis
   -y &lt; Y &gt; 
      = The full-width at half maximum in mm along y-axis
   -z &lt; Z &gt; 
      = The full-width at half maximum in mm along z-axis
   [ -i --iter [ Val ] ]
      = Number of iterations
        With: Val (Default = 10)
   [ -d --debug ]
      = Prints debug information
 Command fields: 
   &lt; petfile &gt; 
      = PET filename
   &lt; outputfile &gt; 
      = output filename
</code></pre>
<ol start="3">
<li>å¹¶è¡Œå¤„ç†</li>
</ol>
<p>è¿™ä¸€æ­¥æ˜¯åœ¨å¤„ç†å¤§é‡ PET æ•°æ®æ—¶ä¸€ä¸ªèŠ‚çœæ—¶é—´çš„åšæ³•ï¼Œä¸å½±å“ PVC æ•ˆæœï¼ŒGNU Parallel çš„å®‰è£…ä¸ä½¿ç”¨è§ä¹‹å‰çš„ FreeSurfer æ“ä½œæ–‡æ¡£ï¼ŒPETPVC åœ¨å¤„ç†æ—¶ä¼šè¿›è¡Œå¤šæ ¸è¿ç®—ï¼Œæ‰€ä»¥æ²¡å¿…è¦å¹¶è¡Œå¤ªå¤šï¼Œä»¥å…æœåŠ¡å™¨å†…å­˜çˆ†æ»¡å¯¼è‡´ PVC å¤±è´¥ã€‚</p>
<pre><code># subject_id.txt å­˜å‚¨äº†å¾…å¤„ç†çš„ Subjects ID
parallel -a subject_id.txt --jobs 4 petpvc -i ./PET/{}.nii.gz -o pvc_RL/{}.nii.gz --pvc RL -x 8 -y 8 -z 8
</code></pre>

                </div>
            </article>
        </div>

        
            <div class="next-post">
                <div class="next gt-c-content-color-first">ä¸‹ä¸€ç¯‡</div>
                <a href="https://yangt.me/post/fxxk-tencent/" class="post-title gt-a-link">
                    æ¯’ç˜¤è½¯ä»¶è‡ªæ•‘æŒ‡å—
                </a>
            </div>
        

        

        

        

        <div class="site-footer gt-c-content-color-first">
    <div class="slogan gt-c-content-color-first">è‹Ÿåˆ©å›½å®¶ç”Ÿæ­»ä»¥ï¼Œå²‚å› ç¥¸ç¦é¿è¶‹ä¹‹ğŸ•¶</div>
    <div class="social-container">
        
            
        
            
        
            
        
            
        
            
        
            
        
    </div>
    <div class="footer-info">
        Copyright &copy; 2019-<span id="footerYear">2019</span> Yang Tian. All rights reserved.
<script type="text/javascript">
document.getElementById('footerYear').innerHTML = new Date().getFullYear();
</script>
    </div>
    <div>
        Theme by <a href="https://imhanjie.com/" target="_blank">imhanjie</a>, Powered by <a
                href="https://github.com/getgridea/gridea" target="_blank">Gridea | <a href="https://yangt.me/atom.xml" target="_blank">RSS</a></a>
    </div>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

    </div>
</div>
</body>
</html>
